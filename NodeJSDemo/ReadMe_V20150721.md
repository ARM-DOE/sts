# Site Transfer Suite Prototyping #

## Version Date: 2015-07-21 ##

NOTES ABOUT RUNNING THE SCRIPTS
-------------------------------

The current prototype consists of the following:

-	receiving side: an HTTP server that uses the *formidable* module
	to parse the information coming from the sender (request from client)
	
-	sending side: an HTTP client emitting a request to the server; the request
	should incorporate the files-to-be-sent METADATA and the actual file content,
	in format given by *MULTIPART-CONTENT* type, that is separated by specified
	boundary key; the files to be sent and their METADATA are listed in JSON format
	in a separate .json file

Running the code procedure (assuming Node.JS is installed):

1. Make sure the following modules are also installed globally, which usually goes in
   ```bash
   $ /usr/local/lib/node_modules/
   ```

2. I have to always set the NODE_PATH using
   ```bash
   $ export NODE_PATH=/usr/local/lib/node_modules/
   ```

3. Start the server/receiver by running
   ```bash
   $ ./formidableReceiverPartFilePromise.js
   ```
4.	Start the client/sender by running
   ```bash
   $ ./startSending.js -f <path to JSON file> -u <size of buffer in kB>
   ```


IMPORTANT NOTES.
----------------

Due to limtations on the maximum number of open files that are OS-specific, I ran into an issue
when I was testing the code with a low chunk size (emulating a very low bandwidth). Therefore, I
had to fix the issue by tweaking some of the OS environment variables as shown below.

1. The command to find those limits is
```bash
$ ulimit -a
```
2. For Linux

 a. Modify /etc/security/limits.conf by adding
 ```bash
 $ *          soft     nproc          65535
 $ *          hard     nproc          65535
 $ *          soft     nofile         65535
 $ *          hard     nofile         65535
 ```
 b. Modify /etc/security/limits.d/90-nproc.conf by adding
 ```bash
 $ *          soft     nproc          65535
 $ *          hard     nproc          65535
 $ *          soft     nofile         65535
 $ *          hard     nofile         65535
 ```
 Log off/Exit and back on, and that should do it, hoepfully.
3. For MacOS - some files might need to be created or just reloaded. If first time, do
 ```bash
 $ echo kern.maxfiles=65536 | sudo tee -a /etc/sysctl.conf
 $ echo kern.maxfilesperproc=65536 | sudo tee -a /etc/sysctl.conf
 $ sudo sysctl -w kern.maxfiles=65536
 $ sudo sysctl -w kern.maxfilesperproc=65536
 $ ulimit -n 65536 65536
 ```

